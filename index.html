<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management System - CRUD App</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="extra_styles.css">
</head>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMIR ISMAIL ABDOU ISMAIL - CRUD App</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="extra_styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1>üìä SAMIR ISMAIL ABDOU ISMAIL</h1>
                <div class="header-actions">
                    <div class="header-actions">
                        <button class="theme-toggle-btn" id="themeToggle" onclick="toggleTheme()"
                            title="Toggle Dark Mode">
                            üåô
                        </button>
                        <button class="btn btn-warning" onclick="loadTestData()" style="margin-right: 5px;">
                            üé≤ Test Data
                        </button>
                        <button id="syncBtn" class="btn btn-sync" onclick="syncData()">
                            <span class="icon">üîÑ</span> Sync
                        </button>
                        <button class="btn btn-info" onclick="openDailyReportModal()">
                            üìÖ Daily Report
                        </button>
                        <div class="connection-status" id="connectionStatus">
                            <span class="status-dot"></span>
                            <span class="status-text">Disconnected</span>
                        </div>
                    </div>
                </div>
            </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- View Tabs -->
            <div id="viewMenu" class="controls-section"
                style="margin-top: -8px; margin-bottom: 8px; transition: all 0.3s ease;">
                <div style="display:flex; gap:8px;">
                    <button class="btn btn-secondary" onclick="switchView('employees')">Employees</button>
                    <button class="btn btn-secondary" onclick="switchView('companies')">Companies</button>
                    <button class="btn btn-secondary" onclick="switchView('daily')">Daily Report</button>
                    <button class="btn btn-secondary" onclick="switchView('pending')">‚ö° Smart Actions</button>
                    <!-- <button class="btn btn-secondary" onclick="switchView('dashboard')">Dashboard</button> -->
                </div>
                <button class="btn btn-sm" id="pinMenuBtn" onclick="toggleMenuPin()"
                    style="background:none; border:none; font-size:1.2rem; cursor:pointer;" title="Pin Menu">üìå</button>
            </div>
        </div>

        <!-- Bulk Actions -->
        <div id="bulkActions" class="bulk-actions"
            style="display: none; background: #fff; padding: 12px; margin-bottom: 16px; border-radius: 8px; align-items: center; justify-content: space-between; border: 1px solid #eee; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <div style="font-weight: 600; color: #333;">
                <span id="selectedCount">0</span> selected
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-sm btn-success" onclick="bulkUpdateStatus('Approved')">‚úÖ Approve</button>
                <button class="btn btn-sm btn-warning" onclick="bulkUpdateStatus('Pending')" style="color:#000;">‚è≥
                    Pending</button>
                <button class="btn btn-sm btn-danger" onclick="bulkDelete()">üóëÔ∏è Delete</button>
            </div>
        </div>

        <!-- Employees Table -->
        <div id="employeesSection" class="table-container">
            <table class="employees-table">
                <thead>
                    <tr>
                        <th width="40" style="text-align: center;"><input type="checkbox" id="selectAll"
                                onclick="toggleSelectAll()"></th>
                        <!-- <th onclick="sortTable('id')" style="cursor: pointer">ID ‚Üï</th> -->
                        <th onclick="sortTable('employeeName')" style="cursor: pointer">Employee Name ‚Üï</th>
                        <th onclick="sortTable('company')" style="cursor: pointer">Company ‚Üï</th>
                        <th onclick="sortTable('profession')" style="cursor: pointer">Profession ‚Üï</th>
                        <th onclick="sortTable('contract')" style="cursor: pointer">Contract ‚Üï</th>
                        <th onclick="sortTable('entryPermitStatus')" style="cursor: pointer">Entry Permit Status ‚Üï</th>
                        <th onclick="sortTable('entryDate')" style="cursor: pointer">Entry Date ‚Üï</th>
                        <th onclick="sortTable('visaLastDay')" style="cursor: pointer">Visa Expiry Date ‚Üï</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeesTableBody">
                    <tr>
                        <td colspan="9" class="no-data">
                            <div class="no-data-message">
                                <span class="icon">üìã</span>
                                <p>No employees found. Click "Sync with Google Sheets" to load data.</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Companies View -->
        <div id="companiesSection" class="table-container" style="display:none;">
            <table class="employees-table">
                <thead>
                    <tr>
                        <th>Company</th>
                        <th>Total Employees</th>
                        <th>Pending</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="companiesTableBody">
                    <tr>
                        <td colspan="4" class="no-data">No companies</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Daily Report View -->
        <div id="dailySection" class="table-container" style="display:none;">
            <table class="employees-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <!-- <th>Category</th> -->
                        <th>Task</th>
                        <th>Employee Name</th>
                        <th>Company</th>
                        <th>Status</th>
                        <th>Notes</th>
                        <th>Sent By</th>
                        <th>Done By</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="dailyReportTableBody">
                    <tr>
                        <td colspan="10" class="no-data">No tasks</td>
                    </tr>
                </tbody>
            </table>
        </div>
        </div>
    </main>

    <!-- Dashboard View -->
    <div id="dashboardSection" class="table-container" style="display:none; padding: 20px;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <!-- Summary Card -->
            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3>üìä Summary</h3>
                <ul style="list-style: none; padding: 0; margin-top: 10px;">
                    <li
                        style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
                        <span>Total Employees</span>
                        <strong id="dashTotal">0</strong>
                    </li>
                    <li
                        style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
                        <span>Total Companies</span>
                        <strong id="dashCompanies">0</strong>
                    </li>
                    <li
                        style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
                        <span>Active Visas</span>
                        <strong id="dashActive" style="color: green;">0</strong>
                    </li>
                    <li style="padding: 10px; display: flex; justify-content: space-between;">
                        <span>Pending Actions</span>
                        <strong id="dashPending" style="color: orange;">0</strong>
                    </li>
                </ul>
            </div>

            <!-- Expiries Card -->
            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3>‚ö†Ô∏è Upcoming Expiries (30 Days)</h3>
                <div id="dashExpiries" style="margin-top: 10px; max-height: 250px; overflow-y: auto;">
                    <p style="color: #888;">No upcoming expiries.</p>
                </div>
            </div>
        </div>

        <div
            style="margin-top: 20px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3>üìà Workflow Progress</h3>
            <div id="dashWorkflow" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                <!-- Will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Employee</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="employeeForm" onsubmit="saveEmployee(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="employeeName">Employee Name *</label>
                        <input type="text" id="employeeName" required placeholder="Full Name">
                    </div>
                    <div class="form-group">
                        <label for="companyName">Company *</label>
                        <select id="companyName" required>
                            <option value="">Select Company</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="profession">Profession</label>
                        <input type="text" id="profession" placeholder="e.g. Engineer">
                    </div>
                    <div class="form-group">
                        <label for="contract">Contract Type</label>
                        <select id="contract">
                            <option value="">Select Type</option>
                            <option value="Full-time">Full-time</option>
                            <option value="Part-time">Part-time</option>
                            <option value="Contract">Contract</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="visaType">Visa Type</label>
                        <select id="visaType" onchange="toggleVisaFields()">
                            <option value="">Select Type</option>
                            <option value="Inside UAE">Inside UAE</option>
                            <option value="Outside UAE">Outside UAE</option>
                        </select>
                    </div>

                    <!-- Current Visa (Inside UAE Only) -->
                    <div class="form-group" id="currentVisaField" style="display:none;">
                        <label for="currentVisaLastDay">Current Visa Inside Last Day</label>
                        <input type="date" id="currentVisaLastDay">
                    </div>

                    <div class="form-group">
                        <label for="entryPermitStatus">Entry Permit Status</label>
                        <select id="entryPermitStatus">
                            <option value="">Select Status</option>
                            <option value="Approved">Approved</option>
                            <option value="Pending">Pending</option>
                            <option value="Rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="entryDate">Entry Date</label>
                        <input type="date" id="entryDate" onchange="calcVisaLastDay()">
                    </div>

                    <!-- New Visa Expiry (Auto +60) -->
                    <div class="form-group">
                        <label for="visaLastDay">Visa Last Day (+60 Days)</label>
                        <input type="date" id="visaLastDay" readonly style="background-color: #e9ecef;">
                    </div>

                    <div class="form-group">
                        <label for="medicalApplication">Medical Application</label>
                        <select id="medicalApplication">
                            <option value="">Select Status</option>
                            <option value="Not Started">Not Started</option>
                            <option value="Applied">Applied</option>
                            <option value="Pending">Pending</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="medicalResult">Medical Result</label>
                        <select id="medicalResult">
                            <option value="">Select Result</option>
                            <option value="Fit">Fit</option>
                            <option value="Unfit">Unfit</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tawjeehSubmission">Tawjeeh Submission</label>
                        <input type="text" id="tawjeehSubmission">
                    </div>
                    <div class="form-group">
                        <label for="iloeNumber">ILOE Number</label>
                        <input type="text" id="iloeNumber">
                    </div>
                    <div class="form-group">
                        <label for="laborCardNumber">Labor Card Number</label>
                        <input type="text" id="laborCardNumber" pattern="\d+" title="Numbers only">
                    </div>
                    <div class="form-group">
                        <label for="eidApplication">EID Application</label>
                        <input type="text" id="eidApplication">
                    </div>
                    <div class="form-group">
                        <label for="eidAppointment">EID Appointment</label>
                        <input type="date" id="eidAppointment">
                    </div>
                    <div class="form-group">
                        <label for="visaStamp">Visa Stamp</label>
                        <input type="text" id="visaStamp">
                    </div>
                </div>
                <input type="hidden" id="employeeId">
                <input type="hidden" id="editMode" value="false">
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="icon">üíæ</span> Save Employee
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Daily Report Modal -->
    <div id="dailyReportModal" class="modal">
        <div class="modal-content" style="max-width: 900px; width: 95%;">
            <div class="modal-header">
                <h2>üìÖ Daily Tasks & Report</h2>
                <button class="close-btn" onclick="closeDailyReportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Add Task Form -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>Add New Task</h3>
                    <form id="dailyReportForm" onsubmit="saveDailyReport(event)"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; align-items: end;">
                        <input type="hidden" id="reportId">
                        <input type="hidden" id="reportRowIndex">
                        <div><label>Date</label><input type="date" id="reportDate" required
                                style="width:100%; padding:8px;"></div>
                        <div><label>Employee Name</label>
                            <select id="reportEmployeeName" style="width:100%; padding:8px;" required>
                                <option value="">Select Employee</option>
                            </select>
                        </div>
                        <div><label>Company</label><input type="text" id="reportCompany" placeholder="Auto"
                                style="width:100%; padding:8px;" readonly></div>
                        <div style="grid-column: span 2;">
                            <label>Task</label>
                            <input type="text" id="reportTask" list="taskSuggestions"
                                placeholder="Select pending or type task" style="width:100%; padding:8px;">
                            <datalist id="taskSuggestions"></datalist>
                        </div>
                        <input type="hidden" id="reportCategory">
                        <div>
                            <label>Status</label>
                            <select id="reportStatus" style="width:100%; padding:8px;">
                                <option>Pending</option>
                                <option>In Progress</option>
                                <option>Completed</option>
                                <option>Cancelled</option>
                            </select>
                        </div>
                        <div><label>Sent By</label><input type="text" id="reportSentBy" placeholder="Name"
                                style="width:100%; padding:8px;"></div>
                        <div><label>Done By</label><input type="text" id="reportDoneBy" placeholder="Team Member"
                                style="width:100%; padding:8px;"></div>
                        <div style="grid-column: 1 / -1;"><label>Notes</label><input type="text" id="reportNotes"
                                placeholder="Additional notes..." style="width:100%; padding:8px;"></div>
                        <div style="grid-column: 1 / -1;"><button type="submit" class="btn btn-primary"
                                style="width: 100%;">Add Task</button></div>
                    </form>
                </div>

                <!-- Tasks List -->
                <h3>Task List</h3>
                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table class="employees-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <!-- <th>Category</th> -->
                                <th>Task</th>
                                <th>Employee</th>
                                <th>Company</th>
                                <th>Status</th>
                                <th>Notes</th>
                                <th>Sent By</th>
                                <th>Done By</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="dailyReportBody">
                            <!-- Tasks go here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Confirm Delete</h2>
                <button class="close-btn" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this employee?</p>
                <p class="warning-text">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDelete()">
                    <span class="icon">üóëÔ∏è</span> Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Company Confirmation Modal -->
    <div id="deleteCompanyModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Delete Company</h2>
                <button class="close-btn" onclick="closeDeleteCompanyModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="deleteCompanyText">Are you sure?</p>
                <p class="warning-text">This will remove the entire sheet tab and all data.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteCompanyModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDeleteCompany()">Delete Company</button>
            </div>
        </div>
    </div>

    <!-- New Company Modal -->
    <div id="companyModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Add New Company</h2>
                <button class="close-btn" onclick="closeCompanyModal()">&times;</button>
            </div>
            <form onsubmit="saveNewCompany(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="newCompanyName">Company Name</label>
                        <input type="text" id="newCompanyName" required placeholder="Enter company name...">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCompanyModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Company</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Pending Actions View -->
    <div id="pendingSection" class="table-container" style="display:none;">
        <table class="employees-table">
            <thead>
                <tr>
                    <th>Employee</th>
                    <th>Company</th>
                    <th>Field</th>
                    <th>Value</th>
                    <th>Add To Daily Report</th>
                </tr>
            </thead>
            <tbody id="pendingActionsBody">
                <tr>
                    <td colspan="5" class="no-data">No pending actions</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Draggable FAB Container -->
    <div id="fabContainer" class="fab-draggable">
        <!-- Main Toggle Button -->
        <div class="fab-main" id="fabMainBtn">
            <button class="fab-btn" title="Actions">‚ö°</button>
        </div>

        <!-- Expanded Menu Items -->
        <div class="fab-menu" id="fabMenu">
            <button class="fab-item" onclick="openDailyReportModal()" title="Add Task" style="--i:0">‚ûï</button>
            <button class="fab-item" onclick="toggleHistory()" title="History" style="--i:1">üïí</button>
            <button class="fab-item" onclick="toggleChat()" title="AI Chat" style="--i:2">ü§ñ</button>
        </div>
    </div>

    <!-- History Panel (Independent) -->
    <div id="historyPanel" class="fab-panel" style="bottom: 100px; right: 80px;">
        <h3>Recent History</h3>
        <ul id="historyList"></ul>
    </div>

    <!-- AI Chat Panel (Independent) -->
    <div id="chatPanel" class="fab-panel chat-panel" style="bottom: 100px; right: 80px;">
        <div class="chat-header">
            <h3>AI Assistant</h3>
            <button class="close-btn-sm" onclick="toggleChat()">&times;</button>
        </div>
        <div id="chatMessages" class="chat-messages"></div>
        <div class="chat-input">
            <input type="text" id="aiInput" placeholder="Ask for smart actions..." onkeypress="handleChatKey(event)">
            <button onclick="sendAiMessage()">‚û§</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="config.js"></script>
    <script src="app.js"></script>
    <script src="ai_features.js"></script>
</body>

</html>